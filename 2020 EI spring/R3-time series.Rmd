---
title: "Energy Informatics R3 - Time series"
output:
  pdf_document: default
  html_document:
    df_print: paged
---
## Author: Richard T. Watson
```{r echo = FALSE, results = 'asis'}
cat(paste('\n###','Date:', Sys.Date()))
```

```{r message=F}
library(readr)
library(dplyr)
library(ggplot2)
library(eia)
library(EIAdata)
```

```{r message=F}
url <- "~/Dropbox/R/EIAAPIkey.txt"
key <- read_delim(url, delim = ',')
eia_set_key(key$key, store = c("env", "options", "sysenv"))
```

## a.
Read the [temperature data](http://www.richardtwatson.com/data/centralparktemps.txt) for Central Park. Compute the average temperature for each year, and create a scatter graph with a linear regression line.

```{r warning=F}
url <- "https://www.richardtwatson.com/data/centralparktemps.txt"
t <- read_delim(url, delim = ',')
a <- t %>% 
  group_by(year) %>% 
  summarize(mean = mean(temperature))
ggplot(a,aes(year,mean)) +
  geom_point() +
  geom_smooth(method = lm) +
  ylim(0,max(a$mean + 10)) +
  xlab('Year') +
  ylab('Average Temperature (F)')
```

## b.
Is the linear relationship between mean temperature and year significant? What do you conclude?

```{r warning=F}
mod <- lm(a$mean ~ a$year)
summary(mod)
```

* As the p-value is less than .05, conclude that there is a significan linear relationship between temperature and year.
* The linear relationship explains 48% of the variation in temperature.

## c.
Read the EIA data on electricity generated by renewables (ELEC.GEN.AOR-US-98.M). Create a time series for monthly MWh. Decompose the time series. What are your conclusions?

```{r warning=F}
id <- "ELEC.GEN.AOR-US-98.M"
d <- eia_series(id)
d1 <-  d$data[[1]] %>% arrange(date)
ts <-  ts(d1$value,start=c(2001),frequency=12)
d2 <-  decompose(ts)
plot(d2)
```

```{r warning=F}
id <- "ELEC.GEN.COW-US-99.M"
d <- eia_series(id)
d1 <-  d$data[[1]] %>% arrange(date)
ts <-  ts(d1$value,start=c(2001),frequency=12)
d2 <-  decompose(ts)
plot(d2)
```

**Conclusion:**  Decomposition shows a long-term upward trend for renewables and a  downward trend for coal starting around 2008. Both have a seasonal effect, but the causes are different. You can control the seasonality of  burning coal for electricity, but the seasonality of renewables is determined by a locality's climate.